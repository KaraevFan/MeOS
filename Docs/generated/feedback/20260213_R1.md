# MeOS MVP — Implementation Spec for Post-Playtest Fixes

**Date:** February 13, 2026
**Context:** This document captures design decisions and implementation requirements based on the founder's first end-to-end playtest of the MeOS MVP. It is intended to be handed to Claude Code for implementation.

**Priority order:** Items are ranked by impact. P0 = trust-breaking (must fix before any external testing), P1 = experience quality, P2 = polish.

---

## P0-1: Opening Conversation Flow — Pulse Check Intake

### Problem
The current opening ("How are you feeling about life right now?") is too open-ended. It creates a blank-page paralysis, and users end up diving deep into one domain without covering the full life map. Sage doesn't have signal on which domains need attention.

### Design Solution: Inline Domain Rating Component + Guided Flow

**Inspiration:** The "Wheel of Life" is the #1 coaching intake tool — coaches ask clients to rate 6-10 life areas on a 1-10 satisfaction scale to get a bird's-eye view before diving deep. Daylio's mood check-in demonstrates that "tap, don't type" interactions get 5-second completion rates. Rosebud asks structured intake questions (age, occupation, relationship status) before the first journal entry to personalize AI responses.

**Our approach combines all three:** a Wheel-of-Life-style rating rendered as an interactive chat component (not a separate screen), followed by Sage using the results to guide the conversation.

### Implementation

#### Step 1: Shorter Sage Greeting
Replace the current long opening message with:

```
Hey — I'm Sage. I'm going to help you build a map of where you are in life right now.

Before we talk, I want to get a quick pulse. Rate each of these areas — don't overthink it, just your gut right now.
```

This message should be immediately followed by the pulse check component (no user input required between greeting and component).

#### Step 2: Pulse Check Component
Render an inline interactive component in the chat (NOT a regular message bubble). This is a new component type.

**Component spec:**
- Full-width card with warm background (slightly different from chat bubbles — use the domain card styling as reference)
- Header: "Life Pulse Check"
- 8 domain rows, each containing:
  - Domain name (left-aligned): Career / Work, Relationships, Health / Body, Finances, Learning / Growth, Creative Pursuits, Play / Fun / Adventure, Meaning / Purpose
  - 5 tappable rating options (right-aligned), displayed as labeled buttons or emoji-style indicators:
    - Thriving (green)
    - Good (teal/blue)
    - Okay (warm yellow)
    - Struggling (soft orange)
    - In Crisis (muted red)
  - Each rating option should be a tappable pill/chip. Only one can be selected per domain.
  - Selected state: filled background with the status color. Unselected: outlined/muted.
- Bottom of card: "Done" button (warm amber CTA style, disabled until at least 4 domains rated)
- Allow partial completion — users can skip domains they don't want to rate. Minimum 4 of 8 to proceed.
- Card should feel quick and lightweight. Target: 30-60 seconds to complete.

**Data model:**
```typescript
interface PulseCheckRating {
  domain: string;           // e.g., "career_work"
  rating: 'thriving' | 'good' | 'okay' | 'struggling' | 'in_crisis';
  ratingNumeric: number;    // 5, 4, 3, 2, 1
  timestamp: string;
}

interface PulseCheckResult {
  ratings: PulseCheckRating[];
  sessionId: string;
  isBaseline: boolean;      // true for first-ever check
}
```

Store pulse check results in the database. These are the "baseline snapshot" — they persist and are shown in the Life Map view as the initial reading.

#### Step 3: Sage Pattern Read Response
After the user submits ratings, send the results to the LLM as structured context. Sage should:

1. Reflect back the shape it sees — acknowledge the highs and lows
2. Propose a starting domain (prioritize "struggling" or "in crisis" areas)
3. Ask a specific, bounded opening question about that domain

**System prompt addition for this phase:**
```
The user just completed a life pulse check. Here are their self-ratings:
[insert ratings]

Your job now:
1. Briefly reflect back the overall pattern you see (1-2 sentences). Note any contrasts between areas.
2. Propose starting with the domain that seems most pressing (lowest rated), but give the user choice.
3. Ask a specific opening question about that domain — NOT "tell me about your career" but something like "You rated career as 'struggling' — what's the main source of tension there right now?"

Do NOT list all 8 domains back to the user. Keep it conversational.
```

#### Step 4: Domain Exploration with Rating Context
As Sage moves through domains during the conversation:
- Quick-reply buttons for remaining domains should be sorted by rating (struggling → thriving)
- Already-explored domains should be REMOVED from the quick-reply options
- For high-rated domains (thriving/good), Sage should offer a lightweight pass: "You rated health as 'good' — want to spend time here or is that a quick confirmation?" This lets stable domains be covered in 2-3 exchanges instead of 10.
- The initial rating for each domain should be included in the system prompt context when exploring that domain, so Sage can reference it.

#### Step 5: Pulse Check in Life Map View
The baseline pulse check ratings should be visible in the Life Map view:
- Show a simple visual indicator next to each domain (color dot matching the rating)
- Label: "Initial pulse: [rating]" with date
- After domain exploration, the domain card's status indicator takes precedence but the baseline is preserved as history

---

## P0-2: Chat Context Persistence

### Problem
Returning to the Chat tab after completing a life mapping session shows the same cold-start opening message ("Hey — I'm Sage..."). This signals amnesia and breaks the core value proposition of persistent understanding.

### Design Solution: State-Aware Chat Entry

The chat view must check the user's current state on mount and render an appropriate contextual opening.

### Implementation

#### State Detection
Add a `session_state` field to the user's profile or a dedicated state table:

```typescript
type SessionState =
  | 'new_user'                    // Never started life mapping
  | 'mapping_in_progress'         // Started but didn't finish all domains
  | 'mapping_complete'            // Life mapping done, between check-ins
  | 'checkin_due'                 // Weekly check-in is due (within 1 day of scheduled time)
  | 'checkin_overdue'             // Past the scheduled check-in time
  | 'mid_conversation'            // User closed app during an active conversation
```

#### State-Based Chat Entry

**State: `new_user`**
Show the pulse check flow described in P0-1.

**State: `mapping_in_progress`**
Sage opening message (template-based, not LLM-generated for speed):
```
Welcome back, [name]. Last time we mapped out [list of explored domains].
Want to keep going?
```
Quick-reply buttons: remaining unexplored domains + "Just want to talk" + "Wrap up with what we have"

**State: `mapping_complete` (not near check-in)**
Sage opening message:
```
Hey [name]. Your next check-in is in [X] days, but I'm here whenever. Anything on your mind?
```
Quick-reply buttons: "Start check-in early" + "Something's on my mind" + "Update my life map"

**State: `checkin_due` or `checkin_overdue`**
Sage opening message:
```
Hey [name] — it's check-in time. Ready to look at how this week went?
```
Quick-reply button: "Let's do it" + "Not right now"

**State: `mid_conversation`**
Load the previous conversation messages and append:
```
Hey — we were in the middle of things. Want to pick up where we left off, or start fresh?
```
Quick-reply buttons: "Continue" + "Start fresh"

#### Conversation History Loading
When entering the chat in any post-mapping state:
- Load the most recent conversation's messages and display them
- New Sage messages append below the existing history
- Ensure the life map context (all domain summaries, synthesis) is included in the system prompt for every new conversation so Sage has full memory

#### Technical Requirements
- On chat view mount: query session state → render appropriate opening
- System prompt must always include: current life map data, pulse check ratings, session history summary
- Conversation history should be loaded from the database, not just session memory
- New conversations should be created as new sessions in the History view, but with full context carryover

---

## P0-3: Finances Domain Card Parse Bug

### Problem
When the LLM returns two domain summaries in a single response (Career/Work + Finances), only the first one parses into a rendered card. The second appears as raw `[DOMAIN_SUMMARY]` markup.

### Fix
The message parser that detects `[DOMAIN_SUMMARY]` blocks needs to handle multiple occurrences within a single message.

**Likely issue:** The parser is using a regex or string match that only captures the first occurrence. Fix by using a global regex or iterating through all matches.

**Test case:** Send a message that contains two `[DOMAIN_SUMMARY]...[/DOMAIN_SUMMARY]` blocks. Both should render as styled domain cards.

**Alternative approach:** Modify the system prompt to instruct the LLM to emit each domain summary as a separate message, not combined. This might be more reliable than fixing the parser for edge cases. Include instruction:
```
IMPORTANT: When generating domain summaries, emit each [DOMAIN_SUMMARY] block as its own message. Never combine two domain summaries in a single response.
```

---

## P1-1: Home Screen — Sage Presence & Life Plan

### Problem
The post-mapping home screen is functional but lifeless — a static list of priorities and a countdown timer. There's no sense of Sage's presence or awareness. It also lacks the "life plan" superstructure that connects the life map (who you are) to concrete projects and commitments (what you're doing about it).

### Design Solution

#### Dynamic Sage Line
Add a contextual one-liner from Sage at the top of the home screen, between the greeting and the check-in timer.

**Implementation:** Template-based for MVP (not LLM-generated — faster, cheaper, more predictable).

Logic:
1. Pull the user's top stated intention from the life map
2. Calculate days since life mapping
3. Select from a template bank:

```typescript
const sageLines = {
  day1: "You mapped your life yesterday. Today's the first day of doing something about it.",
  day2_7: `Day ${daysSinceMapping} of the ${topIntention.shortLabel}. How's momentum?`,
  week2: "Two weeks in. Are things tracking, or has reality intervened?",
  generic: `Your focus: ${topPriority}. One thing today?`,
  checkinSoon: "Check-in's tomorrow. Take a minute to notice how the week felt.",
  postCheckin: "Good check-in. Here's what's carrying forward.",
}
```

Display below the "Good morning, [name]" greeting, above the check-in timer. Style as a distinct element — perhaps a subtle card or quoted text with a small Sage icon.

#### Compounding Engine Display
Add the "Primary Compounding Engine" from the synthesis to the home screen, displayed as a highlighted card below the priorities. This is the user's north star — the most impactful output from the life mapping conversation. It should be visible every time they open the app.

**Layout (top to bottom):**
1. "Good morning, [name]"
2. Sage dynamic line (contextual one-liner)
3. Compounding Engine card (highlighted, distinct styling)
4. Next check-in timer + "Start early" button
5. Current priorities (top 3)
6. "Talk to Sage" button

#### Life Plan Section (Future Enhancement — Design Now, Build Later)
After the life mapping conversation, Sage should ask: "Now that we've mapped the terrain — what do you actually want to focus on? Let's pick 1-2 things for this quarter."

This produces a **Life Plan** artifact with:
- Quarter theme (one phrase)
- 1-2 Anchor Projects with: definition of done, milestones, risk/cut criteria
- Maintenance habits (existing systems to keep running)
- Anti-goals (explicitly not doing)

For MVP: capture this as part of the synthesis/life map data structure. The home screen can display the anchor project milestones as a simple timeline or checklist beneath the priorities.

For later: the Life Map tab gets two sections — "Where I Am" (domain cards) and "What I'm Doing" (life plan with projects, milestones, mechanisms).

**Data model extension:**
```typescript
interface LifePlan {
  quarterTheme: string;
  anchorProjects: AnchorProject[];
  maintenanceHabits: string[];
  antiGoals: string[];          // "Explicitly not doing"
  createdAt: string;
  updatedAt: string;
}

interface AnchorProject {
  name: string;
  definitionOfDone: string;
  whyItMatters: string;
  milestones: Milestone[];
  risks: Risk[];
}

interface Milestone {
  label: string;
  targetDate: string;
  status: 'not_started' | 'in_progress' | 'done';
}

interface Risk {
  description: string;
  cutCriteria: string;        // "If X happens, then Y"
}
```

---

## P2-1: Priority Numbering Fix

### Problem
Priorities display as "1. 1) Build MVP demo..." — double numbering from both the list renderer and the LLM output.

### Fix
Either:
- Strip leading "1) ", "2) ", "3) " patterns from the LLM output before rendering in the numbered list
- OR instruct the LLM in the system prompt to NOT include numbering in priority items (the app handles it)

Prefer the system prompt approach — add to the synthesis generation prompt:
```
When listing priorities, do NOT include numbering (no "1)", "2)", etc.). The app will handle list numbering in the display.
```

---

## P2-2: Quick-Reply Button Filtering

### Problem
After a domain is explored and a domain card is generated, that domain still appears in the quick-reply buttons for "What domain next?"

### Fix
When generating quick-reply buttons after a domain summary:
1. Check which domains have already been explored (have domain cards in the current session)
2. Filter those out of the button list
3. Sort remaining buttons by pulse check rating (struggling → thriving) if pulse check data is available

---

## P2-3: "Explicitly Not Doing Now" → Rename

### Problem
The label "EXPLICITLY NOT DOING NOW" in the synthesis card feels clinical and framework-y. It doesn't match Sage's warm, conversational voice.

### Fix
Rename to "Anti-Goals" or "Choosing Not To" in both:
- The system prompt (instruct the LLM to use the new label)
- The card renderer (if the label is hardcoded in the UI)

Prefer "Anti-Goals" — it's concise and has more energy.

---

## P2-4: Synthesis Card — Collapsible Narrative

### Problem
The synthesis card's narrative paragraph is text-dense on mobile, especially when viewed inline in the chat.

### Fix
When the synthesis card renders inline in the conversation:
- Show the first 3 lines of the narrative paragraph
- Add a "Read more" expand/collapse affordance
- When expanded, show the full text

In the Life Map view (standalone), show the full narrative by default.

---

## System Prompt Updates Summary

Several fixes require system prompt changes. Here's a consolidated list of additions/modifications:

1. **Pulse check context injection:** After pulse check submission, include ratings in system prompt
2. **Single domain summary per message:** "Emit each [DOMAIN_SUMMARY] as its own message. Never combine two in one response."
3. **No numbering in priorities:** "When listing priorities, do NOT include numbering — the app handles display numbering."
4. **Anti-goals label:** Use "ANTI-GOALS" instead of "EXPLICITLY NOT DOING NOW"
5. **Domain exploration guidance:** "After each domain card, check which domains remain unexplored. Only offer those as next options. Sort by pulse check rating if available (struggling first)."
6. **Lightweight pass for high-rated domains:** "For domains the user rated as 'thriving' or 'good' in the pulse check, offer a quick confirmation pass: 'You rated [domain] as [rating] — want to spend time here or is that a quick confirm?'"
7. **Life map context in every conversation:** "Always include the full life map (all domain summaries, synthesis, pulse check baseline) in the system context for every conversation, not just the initial mapping session."

---

## Implementation Order

Recommended sequence for Claude Code:

1. **System prompt updates** (items 2-6 above) — quick wins, no UI changes
2. **Domain card parser fix** (P0-3) — handle multiple summaries per message
3. **Pulse check component** (P0-1) — new UI component + data model
4. **Chat state persistence** (P0-2) — state machine + contextual openings
5. **Home screen Sage presence** (P1-1) — dynamic line + compounding engine card
6. **Polish items** (P2-1 through P2-4) — numbering, filtering, labeling, collapsing
7. **Life Plan data model** (P1-1 future) — schema only, wire up when ready

---

## Files Likely Affected

- System prompt / prompt template files
- Chat message parser (domain summary detection)
- Chat view component (state-aware entry, pulse check component)
- Home screen component (dynamic Sage line, compounding engine card)
- Life map view component (pulse check baseline display)
- Database schema (pulse check ratings table, session state field, life plan tables)
- Quick-reply button generation logic
- Synthesis card renderer (collapsible narrative, label rename)